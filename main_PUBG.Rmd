---
title: "PUBG Strategies"
output: pdf_document
---

## Install libraries
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(reshape2)
library(tidyr)
library(dplyr)
library(scales)
library("plyr")
source('util.R')
```

## Load data
```{r}
#setwd("/Users/alex/Desktop/AMS204-FinalProject")
set.seed(57483)
PUBG_full <- read.csv("data/train_V2.csv")
PUBG_full <- PUBG_full[sample(nrow(PUBG_full)),]
```

## Seperating dataset by match type's covariates and response
```{r}
### Solo first person perspective dataset
solo <- preprocess(PUBG_full, 'solo')
solo_org_small_cov <- solo$first
solo_org_small_resp <- solo$second
solo_org_small_full <- data.frame(solo_org_small_cov, solo_org_small_resp)
colnames(solo_org_small_full)[20] <- 'winPlacePerc'

### Solo first person perspective dataset
solo_fpp <- preprocess(PUBG_full, 'solo-fpp')
solo_fpp_small_cov <- solo_fpp$first
solo_fpp_small_resp <- solo_fpp$second
solo_fpp_small_full <- data.frame(solo_fpp_small_cov, solo_fpp_small_resp)
colnames(solo_fpp_small_full)[20] <- 'winPlacePerc'
```

## K-means clustering
```{r}
### Solo orginal perspective clustering
# Splitting dataset into clusters
solo_org_small_full <- append_clustering_feature(solo_org_small_cov, solo_org_small_full)
solo_org_small <- split_by_the_four_clusters(solo_org_small_full)
cluster_1_solo_org_small <- data.frame(solo_org_small$first) 
cluster_2_solo_org_small <- data.frame(solo_org_small$second) 
cluster_3_solo_org_small <- data.frame(solo_org_small$third) 
cluster_4_solo_org_small <- data.frame(solo_org_small$fourth)

# Splitting the clusters into covariants and response
omit_response <- !names(solo_org_small_full) %in% c("winPlacePerc") 

cluster_1_solo_org_small_cov <- cluster_1_solo_org_small[, omit_response]
cluster_1_solo_org_small_resp <- cluster_1_solo_org_small$winPlacePerc
cluster_2_solo_org_small_cov <- cluster_2_solo_org_small[, omit_response]
cluster_2_solo_org_small_resp <- cluster_2_solo_org_small$winPlacePerc
cluster_3_solo_org_small_cov <- cluster_3_solo_org_small[, omit_response]
cluster_3_solo_org_small_resp <- cluster_3_solo_org_small$winPlacePerc
cluster_4_solo_org_small_cov <- cluster_4_solo_org_small[, omit_response]
cluster_4_solo_org_small_resp <- cluster_4_solo_org_small$winPlacePerc
```

```{r}
### Solo first person perspective clustering
# Splitting dataset into clusters
solo_fpp_small_full <- append_clustering_feature(solo_fpp_small_cov, solo_fpp_small_full)
solo_fpp_small <- split_by_the_four_clusters(solo_fpp_small_full)
cluster_1_solo_fpp_small <- data.frame(solo_fpp_small$first) 
cluster_2_solo_fpp_small <- data.frame(solo_fpp_small$second) 
cluster_3_solo_fpp_small <- data.frame(solo_fpp_small$third) 
cluster_4_solo_fpp_small <- data.frame(solo_fpp_small$fourth)

# Splitting the clusters into covariants and response
omit_response <- !names(solo_fpp_small_full) %in% c("winPlacePerc") 

cluster_1_solo_fpp_small_cov <- cluster_1_solo_fpp_small[, omit_response]
cluster_1_solo_fpp_small_resp <- cluster_1_solo_fpp_small$winPlacePerc
cluster_2_solo_fpp_small_cov <- cluster_2_solo_fpp_small[, omit_response]
cluster_2_solo_fpp_small_resp <- cluster_2_solo_fpp_small$winPlacePerc
cluster_3_solo_fpp_small_cov <- cluster_3_solo_fpp_small[, omit_response]
cluster_3_solo_fpp_small_resp <- cluster_3_solo_fpp_small$winPlacePerc
cluster_4_solo_fpp_small_cov <- cluster_4_solo_fpp_small[, omit_response]
cluster_4_solo_fpp_small_resp <- cluster_4_solo_fpp_small$winPlacePerc
```

## Logistic Regression 
```{r}
### Solo orginal perspective
# OG
train_solo_org_small_cov <- solo_org_small_cov[1:70097,]
train_solo_org_small_resp <- solo_org_small_resp[1:70097]
test_solo_org_small_cov <- solo_org_small_cov[70098:length(solo_org_small_resp),]
test_solo_org_small_resp <- solo_org_small_resp[70098:length(solo_org_small_resp)]

acc_thresh <- test_solo_org_small_resp >= 0.9


solo_org_logit <- logistic(train_solo_org_small_cov, train_solo_org_small_resp)
A_acc_solo_org <- accuracy(solo_org_logit$model, train_solo_org_small_cov, solo_org_logit$thresh)

A_acc_solo_org_test <- accuracy(solo_org_logit$model, test_solo_org_small_cov, acc_thresh)

# Cluster
c1_solo_org_logit<- logistic(cluster_1_solo_org_small_cov, cluster_1_solo_org_small_resp)
acc_c1_solo_org <- accuracy(c1_solo_org_logit$model, cluster_1_solo_org_small_cov, c1_solo_org_logit$thresh)

c2_solo_org_logit<- logistic(cluster_2_solo_org_small_cov, cluster_2_solo_org_small_resp)
acc_c2_solo_org <- accuracy(c2_solo_org_logit$model, cluster_2_solo_org_small_cov, c2_solo_org_logit$thresh)

c3_solo_org_logit<- logistic(cluster_3_solo_org_small_cov, cluster_3_solo_org_small_resp)
acc_c3_solo_org <- accuracy(c3_solo_org_logit$model, cluster_3_solo_org_small_cov, c3_solo_org_logit$thresh)

c4_solo_org_logit<- logistic(cluster_4_solo_org_small_cov, cluster_4_solo_org_small_resp)
acc_c4_solo_org <- accuracy(c4_solo_org_logit$model, cluster_4_solo_org_small_cov, c4_solo_org_logit$thresh)
```

```{r}
### Solo first person perspective
# OG
solo_fpp_logit<- logistic(solo_fpp_small_cov, solo_fpp_small_resp)
acc_solo_fpp <- accuracy(solo_fpp_logit$model, solo_fpp_small_cov, solo_fpp_logit$thresh)

# Cluster
c1_solo_fpp_logit<- logistic(cluster_1_solo_fpp_small_cov, cluster_1_solo_fpp_small_resp)
acc_c1_solo_fpp <- accuracy(c1_solo_fpp_logit$model, cluster_1_solo_fpp_small_cov, c1_solo_fpp_logit$thresh)

c2_solo_fpp_logit<- logistic(cluster_2_solo_fpp_small_cov, cluster_2_solo_fpp_small_resp)
acc_c2_solo_fpp <- accuracy(c2_solo_fpp_logit$model, cluster_2_solo_fpp_small_cov, c2_solo_fpp_logit$thresh)

c3_solo_fpp_logit<- logistic(cluster_3_solo_fpp_small_cov, cluster_3_solo_fpp_small_resp)
acc_c3_solo_fpp <- accuracy(c3_solo_fpp_logit$model, cluster_3_solo_fpp_small_cov, c3_solo_fpp_logit$thresh)

c4_solo_fpp_logit<- logistic(cluster_4_solo_fpp_small_cov, cluster_4_solo_fpp_small_resp)
acc_c4_solo_fpp <- accuracy(c4_solo_fpp_logit$model, cluster_4_solo_fpp_small_cov, c4_solo_fpp_logit$thresh)
```